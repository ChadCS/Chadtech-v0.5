<html>
	<head>
		<title>Chadtech v0.5</title>
		<script type="text/javascript">
			setInterval(draw,100);
			var xMargin = 96;
			var yMargin = 32;
			var chadtechEpoch = Date.now();
			var keysToKeyCodes = {
				'backspace':8,
				'tab':9,

				'enter':13,

				'shift':16,
				'ctrl':17,
				'alt':18,

				'caps lock':20,

				'escape':27,

				'space':32,

				'left':37,
				'up':38,
				'right':39,
				'down':40,

				'delete':46,

				'0':48,
				'1':49,
				'2':50,
				'3':51,
				'4':52,
				'5':53,
				'6':54,
				'7':55,
				'8':56,
				'9':57,

				'a':65,
				'b':66,
				'c':67,
				'd':68,
				'e':69,
				'f':70,
				'g':71,
				'h':72,
				'i':73,
				'j':74,
				'k':75,
				'l':76,
				'm':77,
				'n':78,
				'o':79,
				'p':80,
				'q':81,
				'r':82,
				's':83,
				't':84,
				'u':85,
				'v':86,
				'w':87,
				'y':88,
				'z':90,

				'left command':91,
				'right command':93,

				'numpad0':96,
				'numpad1':97,
				'numpad2':98,
				'numpad3':99,
				'numpad4':100,
				'numpad5':101,
				'numpad6':102,
				'numpad7':103,
				'numpad8':104,
				'numpad9':105,

				'f1':112,
				'f2':113,
				'f3':114,
				'f4':115,
				'f5':116,
				'f6':117,
				'f7':118,
				'f8':119,
				'f9':120,
				'f10':121,
				'f11':122,
				'f12':123,

				'semicolon':186,
				'equals':187,
				'comma':188,
				'minus':189,
				'period':190,
				'forward slash':191,
				'tilda':192,

				'left bracket':219,
				'back slash':220,
				'right bracket':221,
				'single quote':222
			};

			var keyCodesToKeys = {};
			for (var property in keysToKeyCodes){
				keyCodesToKeys[keysToKeyCodes[property]] = property;
			}

			// kkcd is short for 'Key and KeyCode Dictionaries'
			// I dislike ambiguous variable names, but in this case I will be typing this variable
			// several hundred times.
			//
			// kkcd is an array of two dictionaries. The first returns a number given a string
			// The second is the same dictionary, but with the input / output objects
			// switched.
			//
			// This is just for my convenience. So I can type 'the key code corresponding to a'
			// rather than each keycode, where I would be more prone to mistake.

			var kkcd = [keysToKeyCodes,keyCodesToKeys];

			// Each character is invoked by a series of combinations of key strokes.
			// Chadtech will run through each character type, and check, in this order
			// if the keystroke event is an element of the first stimuli,
			// if the keystroke event is not an element of precluding stimuli, if precluding stimuli are mandated (the array is populated)
			// and if the keystroke is an element of the second stimuli, if second stimuli are mandated (the array is populated)
			//
			// If the stimuli conditions exist, the character is added to the document
			//
			// These many conditions are necessary. For example, one might be inclined to think
			// lowercase a can be invoked only by the keystroke 'a'. However it shares this keystroke with
			// capital A. Both lowercase a, and capital A require a condition of the shift Key, even though
			// pressing shift is not necessary to invoke lowercase a. If such condition is not required, pressing shift, 
			// then a, will invoke two characters ('Aa'), even though the keyboard practitioner intends to invoke only 
			// capital A.

			function character(firstConditions,secondConditions,precludingConditions,bigImage,lilImage){
				this.firstConditions = firstConditions;
				this.secondConditions = secondConditions;
				this.precludingConditions = precludingConditions;
				this.bigImage = bigImage;
				this.lilImage = lilImage;
			}

			function zeroPadder(number,zerosToFill){
				var numberAsString = number+'';
				while (numberAsString.length<zerosToFill){
					numberAsString = '0'+numberAsString;
				}
				return numberAsString;
			}

			var characters = [];

			characters.push(new character([kkcd[0]['a']],[],[kkcd[0]['shift']], '', '' )); // lowercase a requires a, then nothing, and not shift
			characters.push(new character([kkcd[0]['b']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['c']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['d']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['e']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['f']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['g']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['h']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['i']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['j']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['k']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['l']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['m']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['o']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['p']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['q']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['r']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['s']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['t']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['u']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['v']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['w']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['x']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['y']],[],[kkcd[0]['shift']], '', '' ));
			characters.push(new character([kkcd[0]['z']],[],[kkcd[0]['shift']], '', '' ));

			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['a']],[], '', '' )); // capital A, requires shift, then a, and not nothing (anything)
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['b']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['c']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['d']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['e']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['f']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['g']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['h']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['i']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['j']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['k']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['l']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['m']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['n']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['o']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['p']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['q']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['r']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['s']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['t']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['u']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['v']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['w']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['x']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['y']],[], '', '' )); 
			characters.push(new character([kkcd[0]['shift']],[kkcd[0]['z']],[], '', '' )); 

			characters.push(new character([kkcd[0]['space']],[],[],'','')); // Space only requires the space bar

			for (var characterItem = 0; characterItem<characters.length; characterItem++){
				characters[characterItem].bigImage = new Image();
				characters[characterItem].bigImage.src='w'+zeroPadder(characterItem,4)+'.PNG';
			}

			var rawDocument = [];
			var currentCursorSpot = 0;
			var currentlyPressedKeys=[];

			var arrayOfWords = [];
			var arrayOfLines = [];
			var arrayOfPages = [];

			function organizeWords(){
				arrayOfWords = [[]];
				for (var documentCharacter=0; documentCharacter<rawDocument.length; documentCharacter++){
					if (rawDocument[documentCharacter]!=52){
						arrayOfWords[arrayOfWords.length-1].push(rawDocument[documentCharacter]);
					}
					else{
						arrayOfWords.push([]);
						arrayOfWords[arrayOfWords.length-1].push(rawDocument[documentCharacter]);
					}
				}
				arrayOfLines = [[]];
				for (var word = 0; word<arrayOfWords.length; word++){
					if ((arrayOfLines[arrayOfLines.length-1].length+arrayOfWords[word].length)<(window.innerWidth-(96*2))){
						arrayOfLines[arrayOfLines.length-1].push(arrayOfWords[word]);
					}
					else{
						arrayOfLines.push([]);
						arrayOfLines[arrayOfLines.length-1].push(arrayOfWords[word]);
					}
				}
			}

			function draw(){
				var chadtechCanvas = document.getElementById("prac").getContext("2d");
				chadtechCanvas.canvas.width = window.innerWidth;
				chadtechCanvas.canvas.height = window.innerHeight;
				chadtechCanvas.fillStyle = "rgb(255,255,255)";
				chadtechCanvas.fillRect(0,0,800,800);
				var time = new Date();
				//for (var characterItem=0; characterItem<characters.length; characterItem++){
				//	chadtechCanvas.drawImage(characters[characterItem].bigImage,characterItem*12+300,300);
				//}
				for (var line = 0; line<arrayOfLines.length; line++){
					for (var word = 0; word <arrayOfLines[line].length; word++){
						for (var characterInstance = 0; characterInstance<arrayOfLines[line][word].length; characterInstance++){
							//WIP
						}
					}
				}
			}

			function documentUpdate(){
				var keepGoingThroughCharacters=true;
				for (var characterItem=0;characterItem<characters.length && keepGoingThroughCharacters;characterItem++){
					for (var aFirstCondition=0;aFirstCondition<characters[characterItem].firstConditions.length;aFirstCondition++){
						if (currentlyPressedKeys.indexOf(characters[characterItem].firstConditions[aFirstCondition])!= -1){
							if (characters[characterItem].precludingConditions.length){
								for (var aPrecludingCondition=0;aPrecludingCondition<characters[characterItem].precludingConditions.length;aPrecludingCondition++){
									if (currentlyPressedKeys.indexOf(characters[characterItem].precludingConditions[aPrecludingCondition])== -1){
										if (characters[characterItem].secondConditions.length){
											for (var aSecondCondition=0;aSecondCondition<characters[characterItem].secondConditions.length;aSecondCondition++){
												if (currentlyPressedKeys.indexOf(characters[characterItem].secondConditions[aSecondCondition])!= -1){
													rawDocument.splice(currentCursorSpot,0,characterItem);
													currentCursorSpot+=1;
													keepGoingThroughCharacters=false;
												}
											}
										}
										else{
											rawDocument.splice(currentCursorSpot,0,characterItem);
											currentCursorSpot+=1;
											keepGoingThroughCharacters=false;
										}
									}
								}	
							}
							else{
								if (characters[characterItem].secondConditions.length){
									for (var aSecondCondition=0;aSecondCondition<characters[characterItem].secondConditions.length;aSecondCondition++){
										if (currentlyPressedKeys.indexOf(characters[characterItem].secondConditions[aSecondCondition])!= -1){
											rawDocument.splice(currentCursorSpot,0,characterItem);
											currentCursorSpot+=1;
											keepGoingThroughCharacters=false;
										}
									}
								}
								else{
									rawDocument.splice(currentCursorSpot,0,characterItem);
									currentCursorSpot+=1;
									keepGoingThroughCharacters=false;
								}
							}
						}
					}
				}
				organizeWords();
			}

			function keyEventDown(event){
				if (currentlyPressedKeys.indexOf(event.keyCode)== -1){
					currentlyPressedKeys.push(event.keyCode);
				}
				console.log(currentlyPressedKeys);
				documentUpdate();

			}

			function keyEventUp(event){
				var indexToRemove = currentlyPressedKeys.indexOf(event.keyCode);
				currentlyPressedKeys.splice(indexToRemove,1);
				//console.log(currentlyPressedKeys);
			}

		</script>
		<style type="text/css">
			canvas { border: 20px; border-style: solid; border-color: #C0C0C0; }
		</style>
	</head>
	<body onkeydown="keyEventDown(event); draw()" onkeyup="keyEventUp(event)">
    	<div style="position: absolute; top:0px; left:0px;">
		<canvas id="prac" width="800" height="800"></canvas>
		</div>
	</body>
</html>