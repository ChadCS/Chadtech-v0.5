<html>
	<head>
		<title>Chadtech v0.5</title>
		<script type="text/javascript">
			setInterval(draw,100);
			var xMargin = 96;
			var yMargin = 32;
			var chadtechEpoch = Date.now();
			var keysToKeyCodes = {
				'backspace':8,
				'tab':9,

				'enter':13,

				'shift':16,
				'ctrl':17,
				'alt':18,

				'caps lock':20,

				'escape':27,

				'space':32,

				'left':37,
				'up':38,
				'right':39,
				'down':40,

				'delete':46,

				'0':48,
				'1':49,
				'2':50,
				'3':51,
				'4':52,
				'5':53,
				'6':54,
				'7':55,
				'8':56,
				'9':57,

				'a':65,
				'b':66,
				'c':67,
				'd':68,
				'e':69,
				'f':70,
				'g':71,
				'h':72,
				'i':73,
				'j':74,
				'k':75,
				'l':76,
				'm':77,
				'n':78,
				'o':79,
				'p':80,
				'q':81,
				'r':82,
				's':83,
				't':84,
				'u':85,
				'v':86,
				'w':87,
				'x':88,
				'y':89,
				'z':90,

				'left command':91,
				'right command':93,

				'numpad0':96,
				'numpad1':97,
				'numpad2':98,
				'numpad3':99,
				'numpad4':100,
				'numpad5':101,
				'numpad6':102,
				'numpad7':103,
				'numpad8':104,
				'numpad9':105,

				'f1':112,
				'f2':113,
				'f3':114,
				'f4':115,
				'f5':116,
				'f6':117,
				'f7':118,
				'f8':119,
				'f9':120,
				'f10':121,
				'f11':122,
				'f12':123,

				'semicolon':186,
				'equals':187,
				'comma':188,
				'minus':189,
				'period':190,
				'forward slash':191,
				'tilda':192,

				'left bracket':219,
				'back slash':220,
				'right bracket':221,
				'single quote':222
			};

			var keyCodesToKeys = {};
			for (var property in keysToKeyCodes){
				keyCodesToKeys[keysToKeyCodes[property]] = property;
			}

			var keyToKeyCodeDictionaries = [keysToKeyCodes,keyCodesToKeys];

			// Each character is invoked by a series of combinations of key strokes.
			// Chadtech will run through each character type, and check, in this order:

			// (0) if the latest key pressed, was a trigger key for that character.;

			// (1) if there are permitting conditions, and if so, that at least one is
			// met. For example, capital A and lowercase are both triggered by the a key,
			// but shift is a permitting condition for capital A.;

			// Though I have called them 'permitting conditions', if there are
			// any of them, it is necessary (not merely permitted) that at least
			// one is met. I call them 'permitting conditions', because each one
			// permits the character, but each one is not necessary (but there being
			// at least one is).

			// (2) that there are no precluding conditions met. For example,
			// shift being currently pressed is a precudling condition
			// for lower case a.

			// Specifying both is necessary. Without precluding conditions for example
			// pressing shift and then a would add to the documnet 'Aa'

			function character(permittingConditions,triggers,precludingConditions,bigImage,lilImage){
				this.permittingConditions = permittingConditions;
				this.triggers = triggers;
				this.precludingConditions = precludingConditions;
				this.bigImage = bigImage;
				this.lilImage = lilImage;
			}

			var characters = [];

			characters.push(new character([],[keyToKeyCodeDictionaries[0]['a']],[keyToKeyCodeDictionaries[0]['shift']], '', '' )); // lowercase a requires a, then nothing, and not shift
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['b']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['c']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['d']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['e']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['f']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['g']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['h']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['i']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['j']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['k']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['l']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['m']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['n']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['o']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['p']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['q']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['r']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['s']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['t']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['u']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['v']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['w']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['x']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['y']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));
			characters.push(new character([],[keyToKeyCodeDictionaries[0]['']],[keyToKeyCodeDictionaries[0]['shift']], '', '' ));

			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['a']],[], '', '' )); // capital A, requires shift, then a, and not nothing (anything)
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['b']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['c']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['d']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['e']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['f']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['g']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['h']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['i']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['j']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['k']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['l']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['m']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['n']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['o']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['p']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['q']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['r']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['s']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['t']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['u']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['v']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['w']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['x']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['y']],[], '', '' )); 
			characters.push(new character([keyToKeyCodeDictionaries[0]['shift']],[keyToKeyCodeDictionaries[0]['z']],[], '', '' )); 

			characters.push(new character([],[keyToKeyCodeDictionaries[0]['space']],[],'','')); // Space only requires the space bar

			function zeroPadder(number,zerosToFill){
				var numberAsString = number+'';
				while (numberAsString.length<zerosToFill){
					numberAsString = '0'+numberAsString;
				}
				return numberAsString;
			}

			for (var characterItem = 0; characterItem<characters.length; characterItem++){
				characters[characterItem].bigImage = new Image();
				characters[characterItem].bigImage.src='w'+zeroPadder(characterItem,4)+'.PNG';
			}

			var commands = [];

			function command(triggers,permittingConditions,execution){
				this.triggers=triggers;
				this.permittingConditions=permittingConditions;
				this.execution=execution;
			}

			commands.push(new command([keyToKeyCodeDictionaries[0]['backspace']],[],function backspace(){
				console.log('PRE',rawDocument);
				rawDocument.splice(currentCursorSpot-1);
				currentCursorSpot-=1;
				console.log('POST',rawDocument);
			}));

			var rawDocument = [];
			var justPressedKey;
			var currentCursorSpot = 0;
			var currentlyPressedKeys=[];

			var arrayOfWords = [];
			var arrayOfLines = [];
			var arrayOfPages = [];

			function organizeWords(){
				arrayOfWords = [[]];
				for (var documentCharacter=0; documentCharacter<rawDocument.length; documentCharacter++){
					if (rawDocument[documentCharacter]!=52){
						arrayOfWords[arrayOfWords.length-1].push(rawDocument[documentCharacter]);
					}
					else{
						arrayOfWords.push([]);
						arrayOfWords[arrayOfWords.length-1].push(rawDocument[documentCharacter]);
					}
				}
				arrayOfLines = [[]];
				var lineLengthInCharacters = 0;
				for (var word = 0; word<arrayOfWords.length; word++){
					if ((lineLengthInCharacters+arrayOfWords[word].length)<Math.floor((window.innerWidth-(96*2))/16)){
						arrayOfLines[arrayOfLines.length-1].push(arrayOfWords[word]);
						lineLengthInCharacters+=arrayOfWords[word].length;
					}
					else{
						arrayOfLines.push([]);
						arrayOfLines[arrayOfLines.length-1].push(arrayOfWords[word]);
						lineLengthInCharacters=0;
					}
				}
				var differentArrayOfLines=[];
				for (var line = 0; line < arrayOfLines.length; line++){
					differentArrayOfLines.push([]);
					for (var word = 0; word<arrayOfLines[line].length; word++){
						for (var characterInstance = 0; characterInstance < arrayOfLines[line][word].length; characterInstance++){
							differentArrayOfLines[differentArrayOfLines.length-1].push(arrayOfLines[line][word][characterInstance]);
						}
					}
				}
				arrayOfLines = differentArrayOfLines;
			}

			function draw(){
				var chadtechCanvas = document.getElementById("prac").getContext("2d");
				chadtechCanvas.canvas.width = window.innerWidth;
				chadtechCanvas.canvas.height = window.innerHeight;
				chadtechCanvas.fillStyle = "rgb(255,255,255)";
				chadtechCanvas.fillRect(0,0,800,800);
				var time = new Date();
				for (var line=0; line<arrayOfLines.length; line++){
					for (var characterInstance=0; characterInstance<arrayOfLines[line].length; characterInstance++){
						chadtechCanvas.drawImage(characters[arrayOfLines[line][characterInstance]].bigImage,(characterInstance*12)+92,(16*line)+32)
					}
				}
			}

			function documentUpdate(){
				var keepGoingThroughCharacters=true;
				for (var characterItem=0; characterItem<characters.length && keepGoingThroughCharacters; characterItem++){
					for (var aTrigger=0; aTrigger<characters[characterItem].triggers.length; aTrigger++){
						if (characters[characterItem].triggers[aTrigger]==justPressedKey){
							var passedAPermittingCondition = !characters[characterItem].permittingConditions.length;
							if (!passedAPermittingCondition){
								for (var aPermittingCondition=0; aPermittingCondition<characters[characterItem].permittingConditions.length; aPermittingCondition++){
									if (currentlyPressedKeys.indexOf(characters[characterItem].permittingConditions[aPermittingCondition])!= -1){
										passedAPermittingCondition=true;
									}
								}
							}
							var passedPrecludingConditions = true;
							for (var aPrecludingCondition=0; aPrecludingCondition<characters[characterItem].precludingConditions.length;aPrecludingCondition++){
								if(currentlyPressedKeys.indexOf(characters[characterItem].precludingConditions[aPrecludingCondition]) != -1){
									passedPrecludingConditions=false;
								}
							}
							if (passedPrecludingConditions && passedAPermittingCondition){
								keepGoingThroughCharacters=false
								rawDocument.splice(currentCursorSpot,0,characterItem);
								currentCursorSpot+=1;
							}
						}
					}
				}
				for (var commandItem=0; commandItem<commands.length; commandItem++){
					console.log('A');
					for (var aTrigger=0; aTrigger<commands[commandItem].triggers.length; aTrigger++){
						console.log('B');
						if(commands[commandItem].triggers[aTrigger]==justPressedKey){
							console.log('C');
							var passedAPermittingCondition = !commands[commandItem].permittingConditions.length;
							if (!passedAPermittingCondition){
								console.log('D');
								for (var aPermittingCondition=0; aPermittingCondition<commands[commandItem].permittingConditions.length; aPermittingCondition++){
									if (currentlyPressedKeys.indexOf(commands[commandItem].permittingConditions[aPermittingCondition])!= -1){
										passedAPermittingCondition=true;
									}
								}
							}
							if(passedAPermittingCondition){
								console.log('E');
								commands[commandItem].execution();
								//whatToExecute();
							}
						}
					}
				}
				organizeWords();
			}

			function keyEventDown(event){
				justPressedKey=event.keyCode;

				if (currentlyPressedKeys.indexOf(event.keyCode)== -1){
					currentlyPressedKeys.push(event.keyCode);
				}
				documentUpdate();

			}

			function keyEventUp(event){
				var indexToRemove = currentlyPressedKeys.indexOf(event.keyCode);
				currentlyPressedKeys.splice(indexToRemove,1);
			}

		</script>
	</head>
	<body onkeydown="keyEventDown(event); draw()" onkeyup="keyEventUp(event)">
    	<div style="position: absolute; top:0px; left:0px;">
		<canvas id="prac" width="800" height="800"></canvas>
		</div>
	</body>
</html>